<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang c√° nh√¢n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" th:href="@{/property/profile/css/profile.css}">
</head>
<body>
<div class="container-fluid main-container">
    <div class="sidebar-left  " style="width: 15%;margin-top: -5%;">
        <h3 class="mb-3">ùì•ùì∑ùì∞ùìªùì™ùì∂</h3>
        <a class="link-icon ms-3" href=""><i class="fa-brands fa-instagram home icons2"></i><span>Trang ch·ªß</span>
        </a>
        <a class=" link-icon " href=""> <i class="fas fa-search icons2" title="Search"></i><span>T√¨m ki·∫øm</span></a>
        <a class=" link-icon  " href=""> <i class="far fa-heart icons2" title="Likes"></i><span>Th√¥ng b√°o</span></a>
        <a class=" link-icon  " href=""> <i class="fa-regular fa-message icons2"></i><span>Tin nh·∫Øn</span></a>
        <a class=" link-icon " href=""> <i class="far fa-user icons2" title="Profile"></i><span>Trang c√° nh√¢n</span></a>
        <a class=" link-icon " style="margin-top: 70%" href=""> <i
                class="fa-solid fa-arrow-right-from-bracket icons2" title="Logout"
        ></i><span>ƒêƒÉng xu·∫•t</span></a>
    </div>
    <div class="main-content flex-grow-1 p-4">
        <div class="profile-header d-flex align-items-center mb-4">
            <img th:src="@{__${user.profilePic}__}" alt="Avatar" class="mr-3">
            <div>
                <h2 th:text="${user.fullName}">Th√°i Quang V·ªπ</h2>
                <div>
                    <th:block th:if="${otherUsers == null}">
                        <button class="btn btn-outline-secondary mr-2">Ch·ªânh s·ª≠a trang c√°
                            nh√¢n
                        </button>
                    </th:block>
                    <th:block th:if="${otherUsers != null}">
                        <div id="friend-actions">
                            <button id="add-friend" class="btn btn-outline-secondary mr-2" style="display:none;">K·∫øt
                                b·∫°n
                            </button>
                            <button id="cancel-request" class="btn btn-outline-secondary mr-2" style="display:none;">X√≥a
                                l·ªùi m·ªùi
                            </button>
                            <button id="accept-request" class="btn btn-outline-secondary mr-2" style="display:none;">
                                Ch·∫•p nh·∫≠n
                            </button>
                            <button id="reject-request" class="btn btn-outline-secondary mr-2" style="display:none;">T·ª´
                                ch·ªëi
                            </button>
                            <button id="friend" class="btn btn-outline-secondary mr-2" style="display:none;">X√≥a b·∫°n
                                b√®
                            </button>
                        </div>
                    </th:block>
                </div>
                <div class="mt-2">
                    <span th:text="${user.posts.size()} + ' b√†i vi·∫øt'">0 b√†i vi·∫øt</span> |
                    <span th:text="${user.countFollower} + ' ng∆∞·ªùi theo d√µi'">1 ng∆∞·ªùi theo d√µi</span> |
                    <span th:text="'ƒêang theo d√µi ' + ${user.countFollowee}">ƒêang theo d√µi 2</span> |
                    <span th:text="${user.countFriends} + ' b·∫°n b√®'">2 b·∫°n b√®</span>
                </div>
            </div>
        </div>
        <div class="post-section text-center" style="margin-top: 50px" th:if="${otherUsers == null}">
            <a class="btn btn-light" style="font-size: 40px" href="/create">
                <i class="fas fa-camera"></i>
            </a>
        </div>
        <div class="underline"></div>
        <p>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                 class="bi bi-collection"
                 viewBox="0 0 16 16">
                <path d="M2.5 3.5a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1zm2-2a.5.5 0 0 1 0-1h7a.5.5 0 0 1 0 1zM0 13a1.5 1.5 0 0 0 1.5 1.5h13A1.5 1.5 0 0 0 16 13V6a1.5 1.5 0 0 0-1.5-1.5h-13A1.5 1.5 0 0 0 0 6zm1.5.5A.5.5 0 0 1 1 13V6a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5z"/>
            </svg>
            B√ÄI VI·∫æT
        </p>
        <div class="gallery row mt-4 justify-content-center">
            <div class="col-4 mb-2" th:each="post :${user.posts}">
                <a th:href="@{/post/__${post.key.id}__}">
                    <img th:src="@{__${post.value}__}" class="img-fluid" alt="Post Image">
                </a>
            </div>
            <div class="col-4 mb-2">
                <img th:src="@{/property/profile/image/file.png}" class="img-fluid" alt="Post Image">
            </div>
            <div class="col-4 mb-2">
                <img th:src="@{/property/profile/image/file.png}" class="img-fluid" alt="Post Image">
            </div>
        </div>
    </div>
</div>
<th:block th:if="${otherUsers == null}">
    <div id="user" th:attr="data-id=${user.id}"></div>
</th:block>
<th:block th:if="${otherUsers != null}">
    <div id="user" th:attr="data-id=${user.id}"></div>
    <div id="otherUsers" th:attr="data-id=${user.id}"></div>
</th:block>
<script>
    $(document).ready(function () {
        const requesterId = 1; // Gi·∫£ s·ª≠ ƒë√¢y l√† ID c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i (l·∫•y t·ª´ session)
        const receiverId = 2; // ID c·ªßa ng∆∞·ªùi d√πng tr√™n trang c√° nh√¢n m√† b·∫°n ƒëang xem

        // H√†m ƒë·ªÉ c·∫≠p nh·∫≠t giao di·ªán n√∫t d·ª±a tr√™n tr·∫°ng th√°i hi·ªán t·∫°i
        function updateFriendButtons(status) {
            if (status === null) {
                $('#add-friend').show();
                $('#cancel-request, #accept-request, #reject-request, #friend').hide();
            } else if (status === 'pending') {
                $('#cancel-request').show();
                $('#add-friend, #accept-request, #reject-request, #friend').hide();
            } else if (status === 'received') {
                $('#accept-request, #reject-request').show();
                $('#add-friend, #cancel-request, #friend').hide();
            } else if (status === 'accepted') {
                $('#friend').show();
                $('#add-friend, #cancel-request, #accept-request, #reject-request').hide();
            }
        }

        // G·ª≠i y√™u c·∫ßu GET ƒë·ªÉ l·∫•y tr·∫°ng th√°i k·∫øt b·∫°n hi·ªán t·∫°i
        $.ajax({
            url: `/friend-request/status/${requesterId}/${receiverId}`,
            method: 'GET',
            success: function (response) {
                updateFriendButtons(response.status);
            },
            error: function (xhr, status, error) {
                console.log('L·ªói khi l·∫•y tr·∫°ng th√°i k·∫øt b·∫°n:', error);
            }
        });

        // S·ª± ki·ªán khi nh·∫•n v√†o n√∫t "K·∫øt b·∫°n"
        $('#add-friend').click(function () {
            $.ajax({
                url: '/friend-request',
                method: 'POST',
                data: {requester_id: requesterId, receiver_id: receiverId},
                success: function () {
                    updateFriendButtons('pending');
                },
                error: function (xhr, status, error) {
                    console.log('L·ªói khi g·ª≠i l·ªùi m·ªùi k·∫øt b·∫°n:', error);
                }
            });
        });

        // S·ª± ki·ªán khi nh·∫•n n√∫t "X√≥a l·ªùi m·ªùi"
        $('#cancel-request').click(function () {
            $.ajax({
                url: `/friend-request/cancel/${requesterId}/${receiverId}`,
                method: 'POST',
                success: function () {
                    updateFriendButtons(null);
                },
                error: function (xhr, status, error) {
                    console.log('L·ªói khi h·ªßy l·ªùi m·ªùi k·∫øt b·∫°n:', error);
                }
            });
        });

        // S·ª± ki·ªán khi nh·∫•n "Ch·∫•p nh·∫≠n l·ªùi m·ªùi"
        $('#accept-request').click(function () {
            $.ajax({
                url: `/friend-request/accept/${requesterId}/${receiverId}`,
                method: 'POST',
                success: function () {
                    updateFriendButtons('accepted');
                },
                error: function (xhr, status, error) {
                    console.log('L·ªói khi ch·∫•p nh·∫≠n l·ªùi m·ªùi k·∫øt b·∫°n:', error);
                }
            });
        });

        // S·ª± ki·ªán khi nh·∫•n "T·ª´ ch·ªëi l·ªùi m·ªùi"
        $('#reject-request').click(function () {
            $.ajax({
                url: `/friend-request/reject/${requesterId}/${receiverId}`,
                method: 'POST',
                success: function () {
                    updateFriendButtons(null);
                },
                error: function (xhr, status, error) {
                    console.log('L·ªói khi t·ª´ ch·ªëi l·ªùi m·ªùi k·∫øt b·∫°n:', error);
                }
            });
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
</body>
</html>